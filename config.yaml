# Nurdle Detection Pipeline - Two-Stage Detection Configuration
# ==============================================================
# SVM Classifier → SVR Regressor → Optional Stacking
# Optimized for simplicity and correctness

# Project Information
project:
  name: "Nurdle Detection Pipeline"
  version: "2.0.0"
  description: "Two-stage nurdle detection with SVM classifier and SVR coordinate regression"

# Data Processing Configuration
data:
  train_test_ratio: 0.8           # Fraction for training (0.8 = 80% train, 20% test)
  target_resolution: 1080         # Target image resolution for normalization
  batch_size: 15                  # Images per RAM batch (memory management)
  input_dir: "input"              # Input directory with images and JSON files
  output_dir: "output"            # Output directory for results

# Window Processing Configuration
windows:
  size: [20, 20]                  # Window size [width, height]
  stride: 12                      # Sliding window stride

# Feature Extraction Configuration  
features:
  hog_cell_size: [4, 4]           # HOG cell size

# Training Configuration
training:
  negative_positive_ratio: 3.0    # Ratio of negative to positive samples (3:1)
  min_distance_from_nurdles: 25   # Minimum pixel distance for negative sample selection

# Model Confidence Configuration
confidence:
  svm_threshold: 0.5              # Minimum SVM confidence to consider window positive
  svr_method: "ensemble"          # "ensemble", "cv_residuals", or "simple"
  svr_ensemble_size: 5            # If using ensemble method

# Stacked Model Configuration (optional advanced mode)
stacking:
  enabled: false                  # Set to true to train and evaluate stacked model
  meta_learner: "logistic_regression"  # or "random_forest"

# Evaluation Configuration  
evaluation:
  # Test set configuration
  test_split_ratio: 0.2  # Portion of data reserved for testing
  
  # Metrics configuration
  metrics:
    calculate_mape: true  # Mean Absolute Percentage Error
    calculate_mae: true   # Mean Absolute Error
    # Note: Pipeline automatically works with real images and their JSON annotations
    # Fallback simulation only used if window metadata is missing
    
  # Visualization settings
  visualization:
    enabled: true  # Whether to generate visualizations
    
    # Plot styling
    figure_size: [12, 8]  # Default figure size (width, height)
    dpi: 300  # Image resolution for saved plots
    
  # Detection parameters
  detection:
    threshold: 0.0  # Default SVM decision boundary (will be optimized)
    iou_threshold: 0.5  # IoU threshold for Non-Maximum Suppression
    optimize_threshold: true  # Whether to optimize detection threshold
    threshold_optimization_metric: "f1"  # Metric for threshold optimization

# System Configuration
system:
  # Logging configuration
  logging:
    level: "INFO"  # "DEBUG", "INFO", "WARNING", "ERROR", "CRITICAL"
    format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
    file_logging: true  # Whether to log to file
    console_logging: true  # Whether to log to console
    
  # Performance and resource settings
  performance:
    # Parallel processing
    n_jobs: -1  # Number of parallel jobs (-1 for all cores, 1 for no parallelism)
    batch_size: 1000  # Batch size for processing large datasets
    
  # Reproducibility
  reproducibility:
    set_random_seeds: true  # Whether to set random seeds for reproducibility
    random_seed: 42  # Master random seed
    
  # Development and debugging
  debug:
    save_intermediate_results: false  # Save intermediate processing results
    verbose_logging: false  # Enable verbose logging for debugging
    profile_performance: false  # Enable performance profiling

# Model Management
model_management:
  # Model saving and loading
  save_models: true  # Whether to save trained models
  model_format: "joblib"  # "joblib" or "pickle"
  
  # Model versioning
  versioning:
    enabled: true
    include_timestamp: true  # Include timestamp in model filenames
    include_config_hash: false  # Include config hash for reproducibility
    
  # Model metadata
  save_metadata: true  # Save model training metadata
  metadata_format: "json"  # Format for metadata files

# Hyperparameter Optimization Configuration
optimization:
  # Sequential optimization strategy
  svm_optimization:
    metric: "f1_score"
    n_trials: 20
    parameter_ranges:
      svm_c: [0.001, 100.0]  # log scale
      svm_kernel: ["linear", "rbf"]
      svm_gamma: [0.001, 1.0]  # log scale, only for rbf
  
  svr_optimization:
    metric: "avg_coordinate_error"  # minimize this
    n_trials: 20
    parameter_ranges:
      svr_c: [0.001, 100.0]  # log scale
      svr_kernel: ["linear", "rbf"]
      svr_gamma: [0.001, 1.0]  # log scale, only for rbf
      svr_epsilon: [0.01, 1.0]  # regression tolerance
    
# Pipeline Control
pipeline:
  # Which steps to run (useful for partial execution)
  steps:
    normalization: true
    train_test_split: true
    sliding_window_processing: true
    feature_extraction: true
    model_training: true
    evaluation: true
    
  # Error handling
  error_handling:
    continue_on_error: false  # Whether to continue pipeline if a step fails
    save_error_logs: true  # Save detailed error information
    
  # Cleanup
  cleanup:
    remove_temp_files: true  # Clean up temporary files after completion
    keep_intermediate_results: false  # Keep intermediate results for inspection